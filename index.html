
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Charmers Checkout</title>
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    input, select, button { display: block; width: 100%; margin-bottom: 10px; padding: 8px; }
    #card-element { padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
    .hidden { display: none; }
    #totalDisplay { font-weight: bold; margin: 10px 0; }
  </style>
</head>
<body>
  <h2>Charmers Checkout</h2>
  <form id="order-form">
    <label>Bracelet Customization:</label>
    <input type="text" id="braceletText" required />

    <label>Select Shipping:</label>
    <select id="shippingMethod" required>
      <option value="10">USA - Ground Advantage $10</option>
      <option value="20">USA - Priority Mail $20</option>
      <option value="50">USA - Priority Mail Express $50</option>
      <option value="50">International Economy $50</option>
      <option value="70">International Express $70</option>
      <option value="9999" disabled>North Korea - Unavailable</option>
      <option value="9999" disabled>South Korea - Unavailable</option>
      <option value="9999" disabled>Antarctica - Unavailable</option>
    </select>

    <label>Name:</label>
    <input type="text" id="name" required />
    <label>Phone Number:</label>
    <input type="text" id="phone" required />
    <label>Email:</label>
    <input type="email" id="email" required />
    <label>Street Address:</label>
    <input type="text" id="address1" required />
    <label>Street Address 2 (Optional):</label>
    <input type="text" id="address2" />
    <label>City:</label>
    <input type="text" id="city" required />
    <label>State/Territory:</label>
    <input type="text" id="state" required />
    <label>Country:</label>
    <input type="text" id="country" required />

    <label>Bracelet Size:</label>
    <select id="braceletSize" required>
      <option>XS</option>
      <option>S</option>
      <option>M</option>
      <option>L</option>
      <option>XL</option>
      <option>XXL</option>
      <option>XXXL</option>
    </select>

    <label>Payment Method:</label>
    <select id="paymentType" required>
      <option value="card">Credit/Debit</option>
      <option value="apple_pay">Apple Pay</option>
      <option value="google_pay">Google Pay</option>
      <option value="cash_app">Cash App</option>
      <option value="paypal">PayPal (manual invoice)</option>
    </select>

    <div id="card-element"></div>

    <div id="totalDisplay">Total: $0.00</div>
    <button type="submit">Pay Now</button>
    <button type="button" id="emailOrder" class="hidden">Send Order Request</button>
  </form>
  <p>Powered by Stripe: pk_live_51ReQgoHwN7YkNv6zwRaz8N1GO0PL7Bb3pqUbcxhss5cQQpJFKjoiNJR4DWKeTRWwhw2tmejOtXjbnrIg6sHnhxc600ePIEIgBc</p>

  <script>
    const stripe = Stripe("pk_live_51ReQgoHwN7YkNv6zwRaz8N1GO0PL7Bb3pqUbcxhss5cQQpJFKjoiNJR4DWKeTRWwhw2tmejOtXjbnrIg6sHnhxc600ePIEIgBc");
    const elements = stripe.elements();
    const card = elements.create("card");
    card.mount("#card-element");

    const form = document.getElementById("order-form");
    const emailOrderBtn = document.getElementById("emailOrder");
    const totalDisplay = document.getElementById("totalDisplay");

    function calculateTotal() {
      const text = document.getElementById("braceletText").value;
      const length = text.length;
      let base = 3;
      if (length > 100) return 0;
      else if (length > 30) base = 15;
      else if (length > 12) base = 10;
      else if (length >= 6) base = 6;
      const shipping = parseFloat(document.getElementById("shippingMethod").value);
      const tax = (base + shipping) * 0.1;
      const total = (base + shipping + tax).toFixed(2);
      totalDisplay.textContent = "Total: $" + total;
      return total;
    }

    form.addEventListener("input", calculateTotal);

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const total = calculateTotal();
      const { paymentMethod } = await stripe.createPaymentMethod({
        type: 'card',
        card: card,
      });
      if (paymentMethod) {
        alert("Payment processed successfully! Now send your order.");
        emailOrderBtn.classList.remove("hidden");
      } else {
        alert("Payment failed. Please check card details.");
      }
    });

    emailOrderBtn.addEventListener("click", () => {
      const email = document.getElementById("email").value;
      const body = encodeURIComponent(`
        Name: ${document.getElementById("name").value}
        Phone: ${document.getElementById("phone").value}
        Address: ${document.getElementById("address1").value} ${document.getElementById("address2").value}, ${document.getElementById("city").value}, ${document.getElementById("state").value}, ${document.getElementById("country").value}
        Bracelet: ${document.getElementById("braceletText").value}
        Size: ${document.getElementById("braceletSize").value}
        Payment: ${document.getElementById("paymentType").value}
        Shipping Cost: $${document.getElementById("shippingMethod").value}
        Total Paid: ${totalDisplay.textContent}
      `);
      window.location.href = `mailto:support@charmersbiz.org?subject=New Bracelet Order&body=${body}`;
    });
  </script>
</body>
</html>
